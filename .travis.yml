#### DO NOT MODIFY. THIS FILE IS AUTOGENERATED ####

dist: trusty
sudo: false

language: generic

services:
    - docker
addons:
  apt:
    packages:
      - docker-ce

script: ./test-build.sh $NODE_VERSION $VARIANT

stages:
  - Test
  - Build
  - name: Deploy
    if: branch = master AND type IN (push)

jobs:
  include:
    - stage: Test
      env:
        - TEST: Doc Toc Check
      language: node_js
      install: npm i -g doctoc
      script:
        - cp README.md README.md.tmp &&
          doctoc --title='## Table of Contents' --github README.md &&
          diff -q README.md README.md.tmp

    - stage: Test
      env:
        - TEST: shfmt check
      script:
        - docker run -it --rm -v "$(pwd)":/sh -w /sh jamesmstone/shfmt -i 2 -l -w -ci .
        - git diff --color
        - git diff --stat=220 --color --exit-code

    - stage: Test
      env:
        - TEST: Shell Check
      script: shellcheck *.sh

    - stage: Deploy
      script: ./generate-stackbrew-pr.sh
      env:
        secure: "HkgYgawkr/hkg2vURHGOb/JmF6U1e71QQsd0HXJ1UJh6WBiFJOrjomCMHZGHnpyopdRna++up8dISBqM2X+EiLAr9yWdRXy72oMP9X42M0ccnja/3E5KYYXMkETS50JnUhMCOt2xRZW5/ojqrHukqRo0YIjIu+P0U0VsZ4QIsng="

    # Docker Build #
    - stage: Build
      env:
         - NODE_VERSION: "10"
         - VARIANT: "default"

    - stage: Build
      env:
         - NODE_VERSION: "10"
         - VARIANT: "alpine"

    - stage: Build
      env:
         - NODE_VERSION: "10"
         - VARIANT: "slim"

    - stage: Build
      env:
         - NODE_VERSION: "10"
         - VARIANT: "stretch"

    - stage: Build
      env:
         - NODE_VERSION: "10"
         - VARIANT: "wheezy"

    - stage: Build
      env:
         - NODE_VERSION: "6"
         - VARIANT: "default"

    - stage: Build
      env:
         - NODE_VERSION: "6"
         - VARIANT: "alpine"

    - stage: Build
      env:
         - NODE_VERSION: "6"
         - VARIANT: "onbuild"

    - stage: Build
      env:
         - NODE_VERSION: "6"
         - VARIANT: "slim"

    - stage: Build
      env:
         - NODE_VERSION: "6"
         - VARIANT: "stretch"

    - stage: Build
      env:
         - NODE_VERSION: "6"
         - VARIANT: "wheezy"

    - stage: Build
      env:
         - NODE_VERSION: "8"
         - VARIANT: "default"

    - stage: Build
      env:
         - NODE_VERSION: "8"
         - VARIANT: "alpine"

    - stage: Build
      env:
         - NODE_VERSION: "8"
         - VARIANT: "onbuild"

    - stage: Build
      env:
         - NODE_VERSION: "8"
         - VARIANT: "slim"

    - stage: Build
      env:
         - NODE_VERSION: "8"
         - VARIANT: "stretch"

    - stage: Build
      env:
         - NODE_VERSION: "8"
         - VARIANT: "wheezy"

    - stage: Build
      env:
         - NODE_VERSION: "9"
         - VARIANT: "default"

    - stage: Build
      env:
         - NODE_VERSION: "9"
         - VARIANT: "alpine"

    - stage: Build
      env:
         - NODE_VERSION: "9"
         - VARIANT: "onbuild"

    - stage: Build
      env:
         - NODE_VERSION: "9"
         - VARIANT: "slim"

    - stage: Build
      env:
         - NODE_VERSION: "9"
         - VARIANT: "stretch"

    - stage: Build
      env:
         - NODE_VERSION: "9"
         - VARIANT: "wheezy"

    - stage: Build
      env:
         - NODE_VERSION: "chakracore/10"
         - VARIANT: "default"

    - stage: Build
      env:
         - NODE_VERSION: "chakracore/8"
         - VARIANT: "default"

